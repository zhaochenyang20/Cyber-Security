# ch12 分布式系统

分布式系统三个属性 1 一致性 2 可用性 3 分区容错性 page8 三者不可兼得

## 12.1 概述

分布式系统由三个部分组成 1 交互网络 2 分布式算法 3 信任模型 书page398

## 12.2 交互网络

**交互网络存在的安全隐患** 书page404

1 数据丢失 2 消息监听 3 伪造与篡改 4 消息重放 5 通信故障 6 日蚀攻击

解决方法 书page408

1 建立 TCP 交互信道，解决数据重放和丢失的问题 2 建立 TLS 交互信道，加密通信

3 防御重放攻击： 1 时间戳 2 随机数 3 时间戳和随机数相结合，只需要在 $\delta$ 时间内随机数不重复即可 书page409

**链路故障**：1 链路崩溃 2 性能问题 page24

解决思路：**弹性覆盖网络 RON** page28 可以使分布式应用检测到路径失效和周期性性能降低的现象

用上述信息来决定，直接通过 Internet 转发；还是通过其他 RON 节点转发

**P2P 网络**建立流程 page35 1 网络节点发现 2 邻居节点维护

日蚀攻击 page38-41 三种方法 1 挤占入向连接 2 挤占出向连接 3 配合路由表劫持攻击 和他们对应的解决办法在 ppt 上

## 12.3 分布式算法

### 12.3.1 时钟同步算法

书page414

**Cristian 算法**，有一个时间服务器作为基准，将收到的时间服务器时间加上一半的传输时延作为自己的时间

**Berkeley 算法** 去分布式系统中其他服务器的平均之间作为最终时间

**NTP 协议 **采用分层的架构 page48

### 12.3.2 并发控制

事务与分布式事务 page51 四个特性 1 原子性 2 一致性 3 隔离性 4 持久性

**两阶段提交确保一致性** 在提交之前先询问所有存储该值的数据库是否可以更新，保证了**一致性**

**基于锁机制确保隔离性** 在对 A 修改之前先上锁，在 Commit 或者 Decommit 之后解除 A 的锁

对于两阶段提交协议，会出现三种故障： 1 数据库节点故障 2 协调者故障 3 链路故障 page55-57

**Quoroum 机制** 书page419

- 满足 一致性准则  和 有效性准则。写 W 个节点自后，认为写操作成功，在读取数据的时候，要读 R 个节点，由于 W+R > N，所以一定能读到正确的数据

Paxos 算法 书page421

- 无leader ，每个节点提出自己的提案，，模拟一群追求快速达成一致的立法者。缺陷在于，追求所有节点相对平等的关系，造成不必要的信息交互。甚至可能会形成**活锁**

Raft 算法 书page423 page68

- 增加了领导者的角色，只有领导者能够提案。算法分为 **领导者选举** 和 **日志复制** 两个部分。只有领导者故障的时候进行领导者选举。当用户来了一个请求，给领导者，领导者试图和所有跟随者同步日志，如果同步成功，则提交事物，并给客户端返回，否则进行回滚。

## 12.4 信任问题

零信任网络：从来不信任，永远在校验 page75

### 12.4.1 访问控制

基于角色的访问控制 RBAC Role Based Access Control。不同角色有不同的操作集，书page425

基于属性的访问控制 ABAC Attribute。包含了新的节点： 1 PEP 策略实施节点 2 PDP 策略决策节点 3 PIP 策略信息节点

基于信任度的访问控制：分为 基本信任，直接信任 和 推荐信任。 基本信任是由自身属性所决定，直接信任随着交互逐渐增加；推荐信任依赖信任值的传递

**访问控制的局限性** page80 无法解决对 **被访问者** 的信任问题，可能访问得到恶意或者无效的资源

### 12.4.2 信任评价模型

page81 包含三个角色，Trustee Trustor Recommender。系统举例 Eigentrust，节点根据历史交互评价计算信誉值。信任评价模型的五个要求 page83



### 12.4.3 拜占庭容错共识

一致性和正确性条件：1 一致性：所有忠诚的副官都服从同样的命令 2 如果将军是忠诚的，每个忠诚的副官都服从他的命令 page96

**口头消息协议 OM 协议**：当存在 m 个叛徒 而且 $n \geq 3m+1$ 的时候，口头消息协议能够确保一致性 page100 

**签名消息协议 SM 协议** 将军和副官发的消息都需要自己的签名，解决了口头消息协议交互复杂度过高的问题。结论，当 $n \geq 2m+1$ 的时候，只需要**两轮交互**，就能确保共识达成 书page429

## 12.5 实用拜占庭容错

PBFT 部分同步算法 page122

PBFT 基于 leader 完成共识，基于 Quromou 机制，这里总结点 n  = 3m+1 ；q=2m+1

PBFT 和 Paxous 和 Raft 区别是，增加了**共识之后的交易确认阶段**

Hotstuff 方案 page127-128

